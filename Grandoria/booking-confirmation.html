<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Booking Confirmation - GAURIKEERTHANA Bootstrap Template</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Josefin+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
  
  <!-- Mobile Responsive CSS -->
  <link href="assets/css/mobile-responsive.css" rel="stylesheet">

  <!-- Payment Gateway Styles -->
  <style>
    .payment-option {
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .payment-option:hover {
      transform: translateY(-2px);
    }
    
    .payment-card {
      border: 2px solid #e9ecef;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      background: #fff;
      transition: all 0.3s ease;
    }
    
    .payment-option:hover .payment-card {
      border-color: #007bff;
      box-shadow: 0 4px 15px rgba(0,123,255,0.1);
    }
    
    .payment-card i {
      font-size: 2rem;
      margin-bottom: 10px;
    }
    
    .payment-card h6 {
      margin-bottom: 5px;
      font-weight: 600;
    }
    
    .payment-card p {
      margin: 0;
      color: #6c757d;
      font-size: 0.9rem;
    }
    
    .booking-summary {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #007bff;
    }
    
    .summary-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #dee2e6;
    }
    
    .summary-item:last-child {
      border-bottom: none;
    }
    
    .success-icon {
      animation: bounce 0.6s ease-in-out;
    }
    
    .failure-icon {
      animation: shake 0.6s ease-in-out;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
      }
      40% {
        transform: translateY(-10px);
      }
      60% {
        transform: translateY(-5px);
      }
    }
    
    @keyframes shake {
      0%, 100% {
        transform: translateX(0);
      }
      10%, 30%, 50%, 70%, 90% {
        transform: translateX(-5px);
      }
      20%, 40%, 60%, 80% {
        transform: translateX(5px);
      }
    }
    
    .booking-details {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
    }
    
    .booking-details p {
      margin: 5px 0;
      font-size: 0.9rem;
    }
  </style>

  <!-- =======================================================
  * Template Name: Gaurikeerthana
  * Template URL: https://bootstrapmade.com/grandoria-bootstrap-hotel-template/
  * Updated: Jul 29 2025 with Bootstrap v5.3.7
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body class="booking-confirmation-page">

  <header id="header" class="header sticky-top">

    <div class="topbar d-flex align-items-center dark-background">
      <div class="container d-flex justify-content-center justify-content-md-between">
        <div class="contact-info d-flex align-items-center">
          <a href="mailto:Gaurikeerthanagvyr@gmail.com">Gaurikeerthanagvyr@gmail.com</a>
          <span class="ms-4">+91 994779277 , +91 4872081979</span>
        </div>
        <div class="social-links d-none d-md-flex align-items-center">
          <a href="https://instagram.com/gaurikeerthanaresidency_" class="instagram"><i class="bi bi-instagram"></i></a>
          <a href="https://wa.me/919947792777" class="Whatsapp"><i class="bi bi-whatsapp"></i></a>
        </div>
      </div>
    </div><!-- End Top Bar -->

    <div class="branding d-flex align-items-cente">
      <div class="container position-relative d-flex align-items-center justify-content-between">
        <a href="index.html" class="logo d-flex align-items-center">
          <!-- Uncomment the line below if you also wish to use an image logo -->
          <!-- <img src="assets/img/logo.webp" alt=""> -->
          <h1 class="sitename">GAURIKEERTHANA</h1>
        </a>

        <nav id="navmenu" class="navmenu">
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="rooms.html">Rooms</a></li>
            <li><a href="amenities.html">Amenities</a></li>
            <li><a href="location.html">Location</a></li>
            <li class="dropdown"><a href="#"><span>Pages</span></a>
              <ul>
                <li><a href="room-details.html">Room Details</a></li>
                <li><a href="gallery.html">Gallery</a></li>
                <li><a href="booking.html" class="active">Booking</a></li>
                <li><a href="terms.html">Terms Page</a></li>
              </ul>
            </li>
            <li><a href="contact.html">Contact</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title light-background">
      <div class="container d-lg-flex justify-content-between align-items-center">
        <h1 class="mb-2 mb-lg-0">Booking Confirmation</h1>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="index.html">Home</a></li>
            <li><a href="booking.html">Booking</a></li>
            <li class="current">Confirmation</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <!-- Booking Confirmation Section -->
    <section id="booking-confirmation" class="booking-confirmation section">

      <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="confirmation-wrapper">

          <!-- Success Message -->
          <div class="confirmation-header text-center" data-aos="fade-up" data-aos-delay="200">
            <div class="success-icon mb-4">
              <i class="bi bi-check-circle-fill text-success"></i>
            </div>
            <h2 class="text-primary">Booking Pending</h2>
            <p class="lead text-muted">Thank you for choosing GAURIKEERTHANA RESIDENCY. Your booking has been successfully processed and we are delighted to welcome you to our hotel.</p>
            <div class="confirmation-number">
              <small class="text-muted">Confirmation Reference:</small>
              <strong class="text-dark d-block" id="booking-reference">Loading...</strong>
            </div>
          </div>

          <div class="row">
            <!-- Booking Details - Left Side -->
            <div class="col-lg-8" data-aos="fade-right" data-aos-delay="300">
              <div class="details-card">
                <h4 class="card-title">Reservation Information</h4>
                <div class="details-list">
                  <div class="detail-item">
                    <span class="label">Guest Name:</span>
                    <span class="value" id="guest-name">-</span>
                  </div>
                  <div class="detail-item">
                    <span class="label">Email Address:</span>
                    <span class="value" id="guest-email">-</span>
                  </div>
                  <div class="detail-item">
                    <span class="label">Contact Number:</span>
                    <span class="value" id="guest-phone">-</span>
                  </div>
                  <div class="detail-item">
                    <span class="label">Check-in Date:</span>
                    <span class="value" id="checkin-date">-</span>
                  </div>
                  <div class="detail-item">
                    <span class="label">Check-out Date:</span>
                    <span class="value" id="checkout-date">-</span>
                  </div>
                  <div class="detail-item">
                    <span class="label">Number of Guests:</span>
                    <span class="value" id="total-guests">-</span>
                  </div>
                  <div class="detail-item">
                    <span class="label">Number of Rooms:</span>
                    <span class="value" id="total-rooms">-</span>
                  </div>
                  <div class="detail-item">
                    <span class="label">Room Type:</span>
                    <span class="value" id="room-type">-</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Booking Summary - Right Side -->
            <div class="col-lg-4" data-aos="fade-left" data-aos-delay="400">
              <div class="summary-card">
                <h4 class="card-title">Booking Summary</h4>
                <div class="summary-details">
                  <div class="summary-item">
                    <span class="label">Room Rate (per night):</span>
                    <span class="value" id="room-rate">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Duration of Stay:</span>
                    <span class="value" id="nights-count">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Room Total:</span>
                    <span class="value" id="subtotal">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="label">GST (5%):</span>
                    <span class="value" id="taxes">-</span>
                  </div>
                  <div class="summary-total">
                    <span class="label">Total Amount:</span>
                    <span class="value" id="total-amount">-</span>
                  </div>
                </div>

                <div class="summary-actions">
                  <button type="button" class="btn btn-primary btn-lg w-100" id="proceed-payment">
                    <i class="bi bi-credit-card me-2"></i>
                    Proceed to Payment Gateway
                  </button>
                </div>

                <div class="payment-notice mt-3">
                  <small class="text-muted">
                    <i class="bi bi-info-circle me-1"></i>
                    Payment will be processed through our secure payment gateway. You will be redirected to complete the transaction.
                  </small>
                </div>
              </div>
            </div>
          </div>

          <!-- Important Information -->
          <div class="important-info" data-aos="fade-up" data-aos-delay="500">
            <div class="info-card">
              <h4 class="card-title"><i class="bi bi-info-circle me-2 text-primary"></i>Important Guest Information</h4>
              <div class="row">
                <div class="col-md-6">
                  <h6 class="text-muted">Check-in & Check-out</h6>
                  <ul class="info-list">
                    <li><strong>Check-in Time:</strong> 3:00 PM onwards</li>
                    <li><strong>Check-out Time:</strong> 11:00 AM</li>
                    <li><strong>Early Check-in:</strong> Subject to availability</li>
                    <li><strong>Late Check-out:</strong> Additional charges may apply</li>
                  </ul>
                </div>
                <div class="col-md-6">
                  <h6 class="text-muted">Policies & Requirements</h6>
                  <ul class="info-list">
                    <li><strong>ID Verification:</strong> Valid government-issued ID required</li>
                    <li><strong>Cancellation:</strong> Free cancellation up to 24 hours before arrival</li>
                    <li><strong>Modifications:</strong> Changes subject to availability and rate differences</li>
                    <li><strong>Contact:</strong> +91 994779277 for assistance</li>
                  </ul>
                </div>
              </div>
              
            </div>
          </div>

        </div>

      </div>

    </section><!-- /Booking Confirmation Section -->

  </main>

  <footer id="footer" class="footer position-relative dark-background">

    <div class="footer-top">
      <div class="container">
        <div class="row gy-4">
          <div class="col-lg-4 col-md-6 footer-about">
            <a href="index.html" class="logo d-flex align-items-center">
              <span class="sitename">GAURIKEERTHANA RESIDENCY</span>
            </a>
            <div class="footer-contact pt-3">
              <p>GAURIKEERTHANA RESIDENCY</p>
              <p>Gaurikeerthana, Kerala, India</p>
              <p class="mt-3"><strong>Phone:</strong> <span>+91 994779277 , +91 4872081979</span></p>
              <p><strong>Email:</strong> <span>Gaurikeerthanagvyr@gmail.com</span></p>
            </div>
          </div>

          <div class="col-lg-2 col-md-3 footer-links">
            <h4>Useful Links</h4>
            <ul>
              <li><a href="#">Home</a></li>
              <li><a href="#">About us</a></li>
              <li><a href="#">Services</a></li>
              <li><a href="#">Terms of service</a></li>
              <li><a href="#">Privacy policy</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="copyright text-center">
      <div class="container d-flex flex-column flex-lg-row justify-content-center justify-content-lg-between align-items-center">
        <div class="d-flex flex-column align-items-center align-items-lg-start">
          <div>
            © Copyright <strong><span>MyWebsite</span></strong>. All Rights Reserved
          </div>
          <div class="credits">
            Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
          </div>
        </div>

        <div class="social-links order-first order-lg-last mb-3 mb-lg-0">
          <a href="https://instagram.com/gaurikeerthanaresidency_"><i class="bi bi-instagram"></i></a>
          <a href="https://wa.me/919947792777"><i class="bi bi-whatsapp"></i></a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>

  <!-- Firebase CDN Scripts -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  
  <!-- Firebase Configuration -->
  <script src="firebase-config-simple.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

  <!-- Booking Confirmation Script -->
  <script>
    // Get URL parameters
    function getUrlParameter(name) {
      name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
      var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
      var results = regex.exec(location.search);
      return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    // Populate booking details from URL parameters
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM Content Loaded - Starting booking confirmation script');
      
      // Get form data from URL parameters
      const bookingId = getUrlParameter('bookingId');
      const guestName = getUrlParameter('primary_guest');
      const guestEmail = getUrlParameter('contact_email');
      const guestPhone = getUrlParameter('contact_phone');
      const arrivalDate = getUrlParameter('arrival_date');
      const departureDate = getUrlParameter('departure_date');
      const guestCount = getUrlParameter('guest_count');
      const roomCount = getUrlParameter('room_count');
      const roomType = getUrlParameter('room_type');
      
      // Debug: Log retrieved values
      console.log('Retrieved URL parameters:', {
        bookingId, guestName, guestEmail, guestPhone, arrivalDate, departureDate, 
        guestCount, roomCount, roomType
      });

      // Set booking reference
      if (bookingId) {
        document.getElementById('booking-reference').textContent = bookingId;
      } else {
        document.getElementById('booking-reference').textContent = 'GR-' + Date.now();
      }

      // Populate the form fields
      if (guestName) document.getElementById('guest-name').textContent = guestName;
      if (guestEmail) document.getElementById('guest-email').textContent = guestEmail;
      if (guestPhone) document.getElementById('guest-phone').textContent = guestPhone;
      if (arrivalDate) document.getElementById('checkin-date').textContent = new Date(arrivalDate).toLocaleDateString();
      if (departureDate) document.getElementById('checkout-date').textContent = new Date(departureDate).toLocaleDateString();
      if (guestCount) document.getElementById('total-guests').textContent = guestCount + ' guest(s)';
      if (roomCount) document.getElementById('total-rooms').textContent = roomCount + ' room(s)';

      // Set room type and pricing
      let roomRate = 0;
      let roomTypeText = '';
      
      switch(roomType) {
        case 'normal-non-ac':
          roomRate = 2500;
          roomTypeText = 'Normal Non-AC Room';
          break;
        case 'normal-ac':
          roomRate = 3500;
          roomTypeText = 'Normal AC Room';
          break;
        case 'deluxe-ac':
          roomRate = 4500;
          roomTypeText = 'Deluxe AC Room';
          break;
      }

      if (roomTypeText) document.getElementById('room-type').textContent = roomTypeText;
      if (roomRate > 0) document.getElementById('room-rate').textContent = '₹' + roomRate.toLocaleString();

      // Calculate pricing
      if (arrivalDate && departureDate && roomRate > 0) {
        const checkin = new Date(arrivalDate);
        const checkout = new Date(departureDate);
        const nights = Math.ceil((checkout - checkin) / (1000 * 60 * 60 * 24));
        const numberOfRooms = parseInt(roomCount) || 1;
        const subtotal = roomRate * nights * numberOfRooms;
        const gst = Math.round(subtotal * 0.05); // 5% GST
        const total = subtotal + gst;

        document.getElementById('nights-count').textContent = nights + ' night(s)';
        document.getElementById('subtotal').textContent = '₹' + subtotal.toLocaleString();
        document.getElementById('taxes').textContent = '₹' + gst.toLocaleString();
        document.getElementById('total-amount').textContent = '₹' + total.toLocaleString();
      }

      // Payment button functionality
      console.log('Setting up payment button event listener');
      const paymentButton = document.getElementById('proceed-payment');
      console.log('Payment button found:', !!paymentButton);
      
      if (paymentButton) {
        paymentButton.addEventListener('click', async function() {
          console.log('Payment button clicked');
          console.log('Firebase service available:', !!window.firebaseBookingService);
          console.log('LocalStorage fallback available:', !!window.localStorageFallback);
          
          // Calculate pricing (move calculation here)
          const checkin = new Date(arrivalDate);
          const checkout = new Date(departureDate);
          const nights = Math.ceil((checkout - checkin) / (1000 * 60 * 60 * 24));
          const numberOfRooms = parseInt(roomCount) || 1;
          const subtotal = roomRate * nights * numberOfRooms;
          const gst = Math.round(subtotal * 0.05); // 5% GST
          const total = subtotal + gst;
          
          console.log('Calculated pricing:', { nights, numberOfRooms, subtotal, gst, total });
          
        // Create booking data (temporary for payment processing)
        const bookingData = {
          bookingId: generateBookingId(),
          guestName: guestName,
          email: guestEmail,
          phone: guestPhone,
          arrivalDate: arrivalDate,
          departureDate: departureDate,
          roomType: roomType,
          roomTypeText: roomTypeText,
          roomCount: roomCount,
          roomRate: roomRate,
          subtotal: subtotal,
          gst: gst,
          total: total,
          timestamp: new Date().toISOString(),
          status: 'pending_payment',
          bookingType: 'ONLINE', // Mark as online booking
          paymentMethod: '', // Will be set when payment method is selected
          paymentDate: '', // Will be set when payment is successful
          paymentStatus: 'pending' // Will be updated based on payment result
        };

        // Show loading state
        this.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Processing...';
        this.disabled = true;

        try {
          // Store booking data temporarily for payment processing only
          localStorage.setItem('currentBooking', JSON.stringify(bookingData));
          console.log('Booking data stored temporarily for payment processing');
          
          // Show payment options (booking will only be saved to database after successful payment)
          showPaymentOptions(bookingData);
          
        } catch (error) {
          console.error('Error processing booking:', error);
          alert('Error processing your booking. Please try again.');
        } finally {
          // Reset button state
          this.innerHTML = '<i class="bi bi-credit-card me-2"></i>Proceed to Payment Gateway';
          this.disabled = false;
        }
      });
      } else {
        console.error('Payment button not found!');
        // Try to find the button with a different selector
        const altButton = document.querySelector('button[type="submit"]') || 
                         document.querySelector('.btn-primary') || 
                         document.querySelector('[onclick*="payment"]');
        console.log('Alternative button found:', !!altButton);
        if (altButton) {
          console.log('Adding click handler to alternative button');
          altButton.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Alternative button clicked - showing payment options');
            // Create a simple booking data object for testing
            const testBookingData = {
              bookingId: 'TEST-' + Date.now(),
              guestName: 'Test User',
              email: 'test@example.com',
              total: 1000,
              status: 'pending_payment'
            };
            showPaymentOptions(testBookingData);
          });
        }
      }


      function generateBookingId() {
        const timestamp = Date.now();
        const random = Math.floor(Math.random() * 1000);
        return `GR-${timestamp}-${random}`;
      }

      function showPaymentOptions(bookingData) {
        // Create payment options modal
        const paymentModal = document.createElement('div');
        paymentModal.className = 'modal fade';
        paymentModal.id = 'paymentModal';
        paymentModal.innerHTML = `
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Choose Payment Method</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div class="row">
                  <div class="col-md-6">
                    <div class="payment-option" onclick="selectPaymentMethod('razorpay')">
                      <div class="payment-card">
                        <i class="bi bi-credit-card-fill text-primary"></i>
                        <h6>Razorpay</h6>
                        <p>Credit/Debit Cards, UPI, Net Banking</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="payment-option" onclick="selectPaymentMethod('payu')">
                      <div class="payment-card">
                        <i class="bi bi-wallet-fill text-success"></i>
                        <h6>PayU</h6>
                        <p>Cards, UPI, Wallets, EMI</p>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row mt-3">
                  <div class="col-md-6">
                    <div class="payment-option" onclick="selectPaymentMethod('phonepe')">
                      <div class="payment-card">
                        <i class="bi bi-phone-fill text-info"></i>
                        <h6>PhonePe</h6>
                        <p>UPI, Cards, Wallets</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="payment-option" onclick="selectPaymentMethod('paytm')">
                      <div class="payment-card">
                        <i class="bi bi-wallet2 text-warning"></i>
                        <h6>Paytm</h6>
                        <p>Paytm Wallet, UPI, Cards</p>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="booking-summary mt-4">
                  <h6>Booking Summary</h6>
                  <div class="summary-item">
                    <span>Total Amount:</span>
                    <strong>₹${bookingData.total.toLocaleString()}</strong>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;

        // Add modal to page
        document.body.appendChild(paymentModal);
        
        // Show modal
        const modal = new bootstrap.Modal(paymentModal);
        modal.show();

        // Remove modal when hidden
        paymentModal.addEventListener('hidden.bs.modal', function() {
          document.body.removeChild(paymentModal);
        });
      }

      // Global function for payment method selection
      window.selectPaymentMethod = function(method) {
        const bookingData = JSON.parse(localStorage.getItem('currentBooking'));
        
        // Update booking with payment method
        bookingData.paymentMethod = method;
        localStorage.setItem('currentBooking', JSON.stringify(bookingData));

        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('paymentModal'));
        modal.hide();

        // Redirect to payment gateway
        redirectToPaymentGateway(method, bookingData);
      };

      function redirectToPaymentGateway(method, bookingData) {
        // Create payment gateway URL with booking data
        const paymentUrl = createPaymentUrl(method, bookingData);
        
        // Show loading message
        document.getElementById('proceed-payment').innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Processing Payment...';
        document.getElementById('proceed-payment').disabled = true;

        // Simulate payment gateway redirect
        setTimeout(() => {
          // In a real implementation, this would redirect to the actual payment gateway
          // For demo purposes, we'll simulate a successful payment
          simulatePaymentSuccess(bookingData);
        }, 2000);
      }

      function createPaymentUrl(method, bookingData) {
        // This would be replaced with actual payment gateway URLs
        const baseUrl = 'https://your-payment-gateway.com/pay';
        const params = new URLSearchParams({
          amount: bookingData.total,
          currency: 'INR',
          order_id: bookingData.bookingId,
          customer_name: bookingData.guestName,
          customer_email: bookingData.email,
          customer_phone: bookingData.phone,
          return_url: window.location.origin + '/payment-success.html',
          cancel_url: window.location.origin + '/booking-confirmation.html'
        });
        
        return `${baseUrl}?${params.toString()}`;
      }

      async function simulatePaymentSuccess(bookingData) {
        // Simulate random payment success/failure (50% chance of each)
        const isPaymentSuccessful = Math.random() > 0.5;
        
        if (isPaymentSuccessful) {
          // Update booking status for successful payment - SAME FORMAT AS WALK-IN BOOKINGS
          bookingData.status = 'confirmed';
          bookingData.paymentStatus = 'success';
          bookingData.paymentDate = new Date().toISOString();
          bookingData.createdAt = new Date();
          bookingData.updatedAt = new Date();
          bookingData.bookingType = 'ONLINE'; // Ensure booking type is set
          
          // Save confirmed booking to Firebase database (only successful transactions)
          try {
            if (window.firebaseBookingService) {
              const bookingId = await window.firebaseBookingService.saveBooking(bookingData);
              bookingData.firebaseId = bookingId;
              console.log('Confirmed booking saved to Firebase with ID:', bookingId);
            } else {
              // Fallback to localStorage if Firebase is not available
              window.localStorageFallback.saveBooking(bookingData);
              console.log('Firebase not available, confirmed booking saved to localStorage fallback');
            }
          } catch (error) {
            console.error('Error saving confirmed booking to Firebase:', error);
            // Fallback to localStorage
            window.localStorageFallback.saveBooking(bookingData);
            console.log('Confirmed booking saved to localStorage due to Firebase error');
          }
          
          // Save confirmed booking locally for admin dashboard
          localStorage.setItem('confirmedBooking', JSON.stringify(bookingData));
          
          // Clear temporary booking data
          localStorage.removeItem('currentBooking');
          
          // Show success message
          showPaymentSuccess(bookingData);
        } else {
          // Update booking status for failed payment
          bookingData.status = 'payment_failed';
          bookingData.paymentStatus = 'failed';
          bookingData.paymentDate = new Date().toISOString();
          bookingData.failureReason = 'Payment gateway declined the transaction';
          
          // DO NOT save failed bookings to database - only store temporarily for retry
          console.log('Payment failed - booking not saved to database');
          
          // Save failed booking locally for retry (not in main database)
          localStorage.setItem('failedBooking', JSON.stringify(bookingData));
          
          // Clear temporary booking data
          localStorage.removeItem('currentBooking');
          
          // Show failure message
          showPaymentFailure(bookingData);
        }
      }

      function showPaymentSuccess(bookingData) {
        // Create success modal
        const successModal = document.createElement('div');
        successModal.className = 'modal fade';
        successModal.id = 'successModal';
        successModal.innerHTML = `
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header bg-success text-white">
                <h5 class="modal-title"><i class="bi bi-check-circle-fill me-2"></i>Payment Successful!</h5>
              </div>
              <div class="modal-body text-center">
                <div class="success-icon mb-3">
                  <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
                </div>
                <h4 class="text-success mb-3">Booking Confirmed!</h4>
                <p class="mb-3">Your payment has been processed successfully.</p>
                <div class="booking-details">
                  <p><strong>Booking ID:</strong> ${bookingData.bookingId}</p>
                  <p><strong>Total Paid:</strong> ₹${bookingData.total.toLocaleString()}</p>
                  <p><strong>Check-in:</strong> ${bookingData.arrivalDate}</p>
                  <p><strong>Check-out:</strong> ${bookingData.departureDate}</p>
                </div>
                <div class="mt-4">
                  <button class="btn btn-primary me-2" onclick="downloadBookingReceipt()">
                    <i class="bi bi-download me-1"></i>Download Receipt
                  </button>
                  <button class="btn btn-outline-primary" onclick="goToHome()">
                    <i class="bi bi-house me-1"></i>Go to Home
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;

        document.body.appendChild(successModal);
        const modal = new bootstrap.Modal(successModal);
        modal.show();

        // Remove modal when hidden
        successModal.addEventListener('hidden.bs.modal', function() {
          document.body.removeChild(successModal);
        });
      }

      function showPaymentFailure(bookingData) {
        // Create failure modal
        const failureModal = document.createElement('div');
        failureModal.className = 'modal fade';
        failureModal.id = 'failureModal';
        failureModal.innerHTML = `
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="bi bi-x-circle-fill me-2"></i>Payment Failed!</h5>
              </div>
              <div class="modal-body text-center">
                <div class="failure-icon mb-3">
                  <i class="bi bi-x-circle-fill text-danger" style="font-size: 3rem;"></i>
                </div>
                <h4 class="text-danger mb-3">Payment Unsuccessful!</h4>
                <p class="mb-3">Your payment could not be processed. Please try again.</p>
                <div class="booking-details">
                  <p><strong>Booking ID:</strong> ${bookingData.bookingId}</p>
                  <p><strong>Amount:</strong> ₹${bookingData.total.toLocaleString()}</p>
                  <p><strong>Failure Reason:</strong> ${bookingData.failureReason}</p>
                  <p><strong>Check-in:</strong> ${bookingData.arrivalDate}</p>
                  <p><strong>Check-out:</strong> ${bookingData.departureDate}</p>
                </div>
                <div class="mt-4">
                  <button class="btn btn-danger me-2" onclick="retryPayment()">
                    <i class="bi bi-arrow-clockwise me-1"></i>Retry Payment
                  </button>
                  <button class="btn btn-outline-secondary" onclick="goToHome()">
                    <i class="bi bi-house me-1"></i>Go to Home
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;

        document.body.appendChild(failureModal);
        const modal = new bootstrap.Modal(failureModal);
        modal.show();

        // Remove modal when hidden
        failureModal.addEventListener('hidden.bs.modal', function() {
          document.body.removeChild(failureModal);
        });
      }

      // Global functions for success modal
      window.downloadBookingReceipt = function() {
        const bookingData = JSON.parse(localStorage.getItem('confirmedBooking'));
        const receiptContent = generateReceiptContent(bookingData);
        
        // Create and download receipt
        const blob = new Blob([receiptContent], { type: 'text/html' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `booking-receipt-${bookingData.bookingId}.html`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
      };

      window.goToHome = function() {
        window.location.href = 'index.html';
      };

      window.retryPayment = function() {
        // Get the failed booking data
        const failedBooking = JSON.parse(localStorage.getItem('failedBooking'));
        
        if (failedBooking) {
          // Reset payment status
          failedBooking.status = 'pending_payment';
          failedBooking.paymentStatus = 'pending';
          delete failedBooking.failureReason;
          
          // Store as current booking for retry
          localStorage.setItem('currentBooking', JSON.stringify(failedBooking));
          
          // Remove failed booking
          localStorage.removeItem('failedBooking');
          
          // Show payment options again
          showPaymentOptions(failedBooking);
        }
      };

      function generateReceiptContent(bookingData) {
        return `
          <!DOCTYPE html>
          <html>
          <head>
            <title>Booking Receipt - ${bookingData.bookingId}</title>
            <style>
              body { font-family: Arial, sans-serif; margin: 20px; }
              .header { text-align: center; border-bottom: 2px solid #007bff; padding-bottom: 20px; margin-bottom: 20px; }
              .booking-details { background: #f8f9fa; padding: 20px; border-radius: 5px; }
              .total { background: #007bff; color: white; padding: 15px; border-radius: 5px; text-align: center; }
            </style>
          </head>
          <body>
            <div class="header">
              <h1>GAURIKEERTHANA RESIDENCY</h1>
              <h2>Booking Receipt</h2>
            </div>
            <div class="booking-details">
              <h3>Booking Information</h3>
              <p><strong>Booking ID:</strong> ${bookingData.bookingId}</p>
              <p><strong>Guest Name:</strong> ${bookingData.guestName}</p>
              <p><strong>Email:</strong> ${bookingData.email}</p>
              <p><strong>Phone:</strong> ${bookingData.phone}</p>
              <p><strong>Check-in:</strong> ${bookingData.arrivalDate}</p>
              <p><strong>Check-out:</strong> ${bookingData.departureDate}</p>
              <p><strong>Room Type:</strong> ${bookingData.roomTypeText}</p>
              <p><strong>Number of Rooms:</strong> ${bookingData.roomCount}</p>
              <p><strong>Payment Method:</strong> ${bookingData.paymentMethod}</p>
              <p><strong>Payment Date:</strong> ${new Date(bookingData.paymentDate).toLocaleString()}</p>
            </div>
            <div class="total">
              <h3>Total Amount Paid: ₹${bookingData.total.toLocaleString()}</h3>
            </div>
            <p style="text-align: center; margin-top: 20px; color: #666;">
              Thank you for choosing GAURIKEERTHANA RESIDENCY!
            </p>
          </body>
          </html>
        `;
      }

    });

    // Admin access with Ctrl+A shortcut
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'a') {
        e.preventDefault();
        window.location.href = 'admin-login.html';
      }
      
      // Walk-in customer booking with Ctrl+B shortcut
      if (e.ctrlKey && e.key === 'b') {
        e.preventDefault();
        openWalkInBookingModal();
      }
    });

    // Walk-in Customer Booking System
    function openWalkInBookingModal() {
      // Create and show walk-in booking modal
      const modalHTML = `
        <div class="modal fade" id="walkInModal" tabindex="-1" aria-labelledby="walkInModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="walkInModalLabel">
                  <i class="bi bi-person-walking me-2"></i>
                  Walk-in Customer Booking
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <!-- Password Authentication -->
                <div id="passwordSection">
                  <div class="alert alert-info">
                    <i class="bi bi-shield-lock me-2"></i>
                    <strong>Authentication Required</strong><br>
                    Enter admin password to access walk-in booking system.
                  </div>
                  <div class="mb-3">
                    <label for="adminPassword" class="form-label">Admin Password</label>
                    <input type="password" class="form-control" id="adminPassword" placeholder="Enter admin password">
                  </div>
                  <button type="button" class="btn btn-primary" onclick="authenticateWalkIn()">
                    <i class="bi bi-unlock me-2"></i>
                    Authenticate
                  </button>
                </div>

                <!-- Walk-in Booking Form -->
                <div id="bookingSection" style="display: none;">
                  <div class="alert alert-success">
                    <i class="bi bi-check-circle me-2"></i>
                    <strong>Authentication Successful!</strong> You can now create walk-in bookings.
                  </div>
                  
                  <form id="walkInBookingForm">
                    <div class="row">
                      <div class="col-md-6">
                        <div class="mb-3">
                          <label for="walkInGuestName" class="form-label">Guest Name *</label>
                          <input type="text" class="form-control" id="walkInGuestName" required>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="mb-3">
                          <label for="walkInPhone" class="form-label">Phone Number *</label>
                          <input type="tel" class="form-control" id="walkInPhone" required>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-6">
                        <div class="mb-3">
                          <label for="walkInEmail" class="form-label">Email</label>
                          <input type="email" class="form-control" id="walkInEmail">
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="mb-3">
                          <label for="walkInAdults" class="form-label">Number of Adults *</label>
                          <select class="form-select" id="walkInAdults" required>
                            <option value="">Select</option>
                            <option value="1">1 Adult</option>
                            <option value="2">2 Adults</option>
                            <option value="3">3 Adults</option>
                            <option value="4">4 Adults</option>
                            <option value="5">5+ Adults</option>
                          </select>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-6">
                        <div class="mb-3">
                          <label for="walkInChildren" class="form-label">Number of Children</label>
                          <select class="form-select" id="walkInChildren">
                            <option value="0">No Children</option>
                            <option value="1">1 Child</option>
                            <option value="2">2 Children</option>
                            <option value="3">3 Children</option>
                            <option value="4">4+ Children</option>
                          </select>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="mb-3">
                          <label for="walkInRoomType" class="form-label">Room Type *</label>
                          <select class="form-select" id="walkInRoomType" required onchange="checkRoomAvailability()">
                            <option value="">Select Room Type</option>
                            <option value="Normal Non-AC Room" data-price="2000">Normal Non-AC Room - ₹2,000/night</option>
                            <option value="Normal AC Room" data-price="2500">Normal AC Room - ₹2,500/night</option>
                            <option value="Deluxe AC Room" data-price="4500">Deluxe AC Room - ₹4,500/night</option>
                          </select>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-4">
                        <div class="mb-3">
                          <label for="walkInRoomCount" class="form-label">Number of Rooms *</label>
                          <select class="form-select" id="walkInRoomCount" required onchange="calculateWalkInTotal()">
                            <option value="">Select Rooms</option>
                            <option value="1">1 Room</option>
                            <option value="2">2 Rooms</option>
                            <option value="3">3 Rooms</option>
                            <option value="4">4 Rooms</option>
                            <option value="5">5 Rooms</option>
                            <option value="6">6 Rooms</option>
                          </select>
                          <small class="form-text text-muted">Maximum rooms available will be shown based on room type</small>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="mb-3">
                          <label for="walkInCheckIn" class="form-label">Check-in Date *</label>
                          <input type="date" class="form-control" id="walkInCheckIn" required onchange="calculateWalkInTotal()">
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="mb-3">
                          <label for="walkInCheckOut" class="form-label">Check-out Date *</label>
                          <input type="date" class="form-control" id="walkInCheckOut" required onchange="calculateWalkInTotal()">
                        </div>
                      </div>
                    </div>

                    <!-- Room Availability Status -->
                    <div id="roomAvailabilityStatus" class="mb-3" style="display: none;">
                      <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        <span id="availabilityMessage">Checking room availability...</span>
                      </div>
                    </div>

                    <!-- Price Summary -->
                    <div class="card">
                      <div class="card-header">
                        <h6 class="mb-0">Booking Summary</h6>
                      </div>
                      <div class="card-body">
                        <div class="row">
                          <div class="col-md-6">
                            <p><strong>Room Type:</strong> <span id="summaryRoomType">-</span></p>
                            <p><strong>Number of Rooms:</strong> <span id="summaryRoomCount">-</span></p>
                            <p><strong>Duration:</strong> <span id="summaryNights">-</span></p>
                          </div>
                          <div class="col-md-6">
                            <p><strong>Price per room/night:</strong> ₹<span id="summaryPrice">-</span></p>
                            <p><strong>Subtotal:</strong> ₹<span id="summarySubtotal">-</span></p>
                            <p><strong>Total Amount:</strong> ₹<span id="summaryTotal">-</span></p>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="mb-3">
                      <label for="walkInSpecialRequests" class="form-label">Special Requests</label>
                      <textarea class="form-control" id="walkInSpecialRequests" rows="3" placeholder="Any special requests or notes..."></textarea>
                    </div>
                  </form>
                </div>
              </div>
              
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="confirmWalkInBooking" onclick="confirmWalkInBooking()" style="display: none;">
                  <i class="bi bi-check-circle me-2"></i>
                  Confirm Walk-in Booking
                </button>
              </div>
            </div>
          </div>
        </div>
      `;

      // Remove existing modal if any
      const existingModal = document.getElementById('walkInModal');
      if (existingModal) {
        existingModal.remove();
      }

      // Add modal to page
      document.body.insertAdjacentHTML('beforeend', modalHTML);

      // Show modal
      const modal = new bootstrap.Modal(document.getElementById('walkInModal'));
      modal.show();

      // Set today's date as minimum date
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('walkInCheckIn').min = today;
      document.getElementById('walkInCheckOut').min = today;

      console.log('Walk-in booking modal opened (Ctrl+B)');
    }

    // Authenticate walk-in booking access
    function authenticateWalkIn() {
      const password = document.getElementById('adminPassword').value;
      
      if (password === 'admin') {
        // Show booking form and hide password section
        document.getElementById('passwordSection').style.display = 'none';
        document.getElementById('bookingSection').style.display = 'block';
        document.getElementById('confirmWalkInBooking').style.display = 'block';
        
        console.log('Walk-in authentication successful');
      } else {
        alert('❌ Invalid password! Please enter the correct admin password.');
        document.getElementById('adminPassword').focus();
      }
    }

    // Check room availability for walk-in customers
    async function checkRoomAvailability() {
      const roomType = document.getElementById('walkInRoomType').value;
      const roomCount = parseInt(document.getElementById('walkInRoomCount').value) || 1;
      const checkIn = document.getElementById('walkInCheckIn').value;
      const checkOut = document.getElementById('walkInCheckOut').value;

      if (!roomType || !checkIn || !checkOut) {
        document.getElementById('roomAvailabilityStatus').style.display = 'none';
        return;
      }

      const availabilityDiv = document.getElementById('roomAvailabilityStatus');
      const messageSpan = document.getElementById('availabilityMessage');
      
      availabilityDiv.style.display = 'block';
      messageSpan.innerHTML = `<i class="bi bi-hourglass-split me-2"></i>Checking availability for ${roomCount} ${roomType}(s)...`;
      availabilityDiv.className = 'mb-3 alert alert-info';

      try {
        // Check availability using Firebase
        const result = await checkRoomAvailabilityAPI(roomType, checkIn, checkOut, roomCount);
        
        if (result.available) {
          messageSpan.innerHTML = `<i class="bi bi-check-circle me-2"></i>✅ ${roomCount} ${roomType}(s) available! (${result.availableRooms}/${result.totalRooms} total available)`;
          availabilityDiv.className = 'mb-3 alert alert-success';
        } else {
          let message = `<i class="bi bi-x-circle me-2"></i>❌ Only ${result.availableRooms} ${roomType}(s) available (${roomCount} requested). `;
          if (result.availableRooms > 0) {
            message += `Please reduce the number of rooms or try different dates.`;
          } else {
            message += `Please try different dates or room type.`;
          }
          
          if (result.conflictingBookings && result.conflictingBookings.length > 0) {
            message += `<br><small>Conflicting bookings found for these dates.</small>`;
          }
          
          messageSpan.innerHTML = message;
          availabilityDiv.className = 'mb-3 alert alert-danger';
        }
      } catch (error) {
        console.error('Error checking availability:', error);
        messageSpan.innerHTML = '<i class="bi bi-exclamation-triangle me-2"></i>⚠️ Unable to check availability. Please try again.';
        availabilityDiv.className = 'mb-3 alert alert-warning';
      }
    }

    // Check room availability using Firebase
    async function checkRoomAvailabilityAPI(roomType, checkIn, checkOut, requestedRooms = 1) {
      try {
        // Check if Firebase is available
        if (window.firebaseBookingService && firebaseInitialized) {
          console.log('Using Firebase for room availability check');
          const result = await window.firebaseBookingService.checkRoomAvailability(roomType, checkIn, checkOut, requestedRooms);
          return result;
        } else {
          console.log('Firebase not available, using fallback availability check');
          // Fallback to mock availability logic
          const unavailableDates = [
            '2024-01-15', '2024-01-16', '2024-01-20', '2024-01-25'
          ];
          
          const startDate = new Date(checkIn);
          const endDate = new Date(checkOut);
          
          // Check if any date in the range is unavailable
          for (let d = new Date(startDate); d < endDate; d.setDate(d.getDate() + 1)) {
            const dateStr = d.toISOString().split('T')[0];
            if (unavailableDates.includes(dateStr)) {
              return {
                available: false,
                availableRooms: 0,
                totalRooms: 10,
                message: 'Rooms not available for these dates'
              };
            }
          }
          
          return {
            available: true,
            availableRooms: 10,
            totalRooms: 10,
            message: 'Rooms available'
          };
        }
      } catch (error) {
        console.error('Error checking room availability:', error);
        // Return false on error to be safe
        return {
          available: false,
          availableRooms: 0,
          totalRooms: 10,
          message: 'Error checking availability'
        };
      }
    }

    // Calculate total for walk-in booking
    function calculateWalkInTotal() {
      const roomType = document.getElementById('walkInRoomType');
      const roomCount = parseInt(document.getElementById('walkInRoomCount').value) || 1;
      const checkIn = document.getElementById('walkInCheckIn').value;
      const checkOut = document.getElementById('walkInCheckOut').value;

      if (!roomType.value || !checkIn || !checkOut) {
        updateWalkInSummary();
        return;
      }

      const pricePerNight = parseInt(roomType.selectedOptions[0].dataset.price);
      const startDate = new Date(checkIn);
      const endDate = new Date(checkOut);
      const nights = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));

      const subtotal = pricePerNight * nights;
      const total = subtotal * roomCount;

      // Update summary
      document.getElementById('summaryRoomType').textContent = roomType.value;
      document.getElementById('summaryRoomCount').textContent = `${roomCount} room(s)`;
      document.getElementById('summaryNights').textContent = `${nights} night(s)`;
      document.getElementById('summaryPrice').textContent = pricePerNight.toLocaleString();
      document.getElementById('summarySubtotal').textContent = subtotal.toLocaleString();
      document.getElementById('summaryTotal').textContent = total.toLocaleString();

      // Check availability after calculation
      checkRoomAvailability();

      console.log(`Walk-in booking calculation: ${roomCount} room(s) × ${nights} nights × ₹${pricePerNight} = ₹${total}`);
    }

    // Update walk-in booking summary
    function updateWalkInSummary() {
      document.getElementById('summaryRoomType').textContent = '-';
      document.getElementById('summaryRoomCount').textContent = '-';
      document.getElementById('summaryNights').textContent = '-';
      document.getElementById('summaryPrice').textContent = '-';
      document.getElementById('summarySubtotal').textContent = '-';
      document.getElementById('summaryTotal').textContent = '-';
    }

    // Confirm walk-in booking
    function confirmWalkInBooking() {
      const form = document.getElementById('walkInBookingForm');
      const formData = new FormData(form);
      
      // Validate required fields
      const requiredFields = ['walkInGuestName', 'walkInPhone', 'walkInAdults', 'walkInRoomType', 'walkInRoomCount', 'walkInCheckIn', 'walkInCheckOut'];
      const missingFields = [];
      
      requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (!field.value.trim()) {
          missingFields.push(field.labels[0].textContent);
        }
      });

      if (missingFields.length > 0) {
        alert(`❌ Please fill in the following required fields:\n• ${missingFields.join('\n• ')}`);
        return;
      }

      // Get booking data
      const bookingData = {
        guestName: document.getElementById('walkInGuestName').value,
        phone: document.getElementById('walkInPhone').value,
        email: document.getElementById('walkInEmail').value,
        adults: parseInt(document.getElementById('walkInAdults').value),
        children: parseInt(document.getElementById('walkInChildren').value),
        roomType: document.getElementById('walkInRoomType').value,
        roomCount: parseInt(document.getElementById('walkInRoomCount').value),
        arrivalDate: document.getElementById('walkInCheckIn').value,
        departureDate: document.getElementById('walkInCheckOut').value,
        specialRequests: document.getElementById('walkInSpecialRequests').value,
        bookingType: 'WALK_IN',
        bookingDate: new Date().toISOString(),
        status: 'CONFIRMED'
      };

      // Calculate total
      const pricePerNight = parseInt(document.getElementById('walkInRoomType').selectedOptions[0].dataset.price);
      const startDate = new Date(bookingData.arrivalDate);
      const endDate = new Date(bookingData.departureDate);
      const nights = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
      const subtotal = pricePerNight * nights;
      bookingData.total = subtotal * bookingData.roomCount;

      console.log('Walk-in booking data:', bookingData);

      // Save to database (simulate API call)
      saveWalkInBooking(bookingData);
    }

    // Save walk-in booking to database
    async function saveWalkInBooking(bookingData) {
      try {
        console.log('Saving walk-in booking:', bookingData);
        
        let bookingId;
        
        // Try to save to Firebase first
        if (window.firebaseBookingService && firebaseInitialized) {
          console.log('Using Firebase for walk-in booking save');
          const result = await window.firebaseBookingService.saveWalkInBooking(bookingData);
          bookingId = result.bookingId;
          console.log('Walk-in booking saved to Firebase:', result);
        } else {
          console.log('Firebase not available, using fallback save');
          // Fallback: generate booking ID and save to localStorage
          bookingId = 'WI' + Date.now();
          bookingData.bookingId = bookingId;
          
          // Save to localStorage as fallback
          const existingBookings = JSON.parse(localStorage.getItem('walkInBookings') || '[]');
          existingBookings.push(bookingData);
          localStorage.setItem('walkInBookings', JSON.stringify(existingBookings));
          
          console.log('Walk-in booking saved to localStorage:', bookingId);
        }

        // Show success message
        const successMessage = `
          ✅ Walk-in Booking Confirmed!
          
          Booking ID: ${bookingId}
          Guest: ${bookingData.guestName}
          Room: ${bookingData.roomType} (${bookingData.roomCount} room${bookingData.roomCount > 1 ? 's' : ''})
          Check-in: ${bookingData.arrivalDate}
          Check-out: ${bookingData.departureDate}
          Total: ₹${bookingData.total.toLocaleString()}
          
          The booking has been saved ${window.firebaseBookingService && firebaseInitialized ? 'to Firebase database' : 'to local storage'}.
        `;

        alert(successMessage);

        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('walkInModal'));
        modal.hide();

        // Clear form for next booking
        document.getElementById('walkInBookingForm').reset();
        updateWalkInSummary();

        console.log('Walk-in booking saved successfully:', bookingId);

      } catch (error) {
        console.error('Error saving walk-in booking:', error);
        alert('❌ Error saving booking. Please try again.\n\nError: ' + error.message);
      }
    }
  </script>

</body>

</html>

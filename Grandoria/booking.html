<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Booking - Gaurikeerthana Bootstrap Template</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Josefin+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <!-- Availability Check Styles -->
  <style>
    .availability-status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #e9ecef;
      background: #f8f9fa;
      transition: all 0.3s ease;
    }

    .availability-status.checking {
      border-color: #ffc107;
      background: #fff3cd;
    }

    .availability-status.available {
      border-color: #28a745;
      background: #d4edda;
    }

    .availability-status.unavailable {
      border-color: #dc3545;
      background: #f8d7da;
    }

    .availability-content {
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .availability-icon {
      flex-shrink: 0;
      margin-top: 2px;
    }

    .availability-icon i {
      font-size: 1.2rem;
    }

    .availability-status.checking .availability-icon i {
      color: #ffc107;
      animation: spin 1s linear infinite;
    }

    .availability-status.available .availability-icon i {
      color: #28a745;
    }

    .availability-status.unavailable .availability-icon i {
      color: #dc3545;
    }

    .availability-text h6 {
      margin: 0 0 5px 0;
      font-weight: 600;
    }

    .availability-status.checking .availability-text h6 {
      color: #856404;
    }

    .availability-status.available .availability-text h6 {
      color: #155724;
    }

    .availability-status.unavailable .availability-text h6 {
      color: #721c24;
    }

    .availability-text p {
      margin: 0;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .availability-actions {
      margin-top: 12px;
      text-align: right;
    }

    .alternative-options {
      margin-top: 15px;
      padding: 12px;
      background: white;
      border-radius: 8px;
      border: 1px solid #dee2e6;
    }

    .alternative-options h6 {
      margin: 0 0 10px 0;
      color: #495057;
      font-size: 0.9rem;
    }

    .alternative-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .alternative-list li {
      padding: 5px 0;
      font-size: 0.85rem;
      color: #6c757d;
    }

    .alternative-list li:before {
      content: "• ";
      color: #007bff;
      font-weight: bold;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .form-group.disabled {
      opacity: 0.6;
      pointer-events: none;
    }

    .btn-check-availability {
      margin-top: 10px;
      width: 100%;
    }

    #room-count:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      background-color: #f8f9fa;
    }

    .form-group.disabled {
      opacity: 0.6;
    }
  </style>

  <!-- =======================================================
  * Template Name: Gaurikeerthana
  * Template URL: https://bootstrapmade.com/grandoria-bootstrap-hotel-template/
  * Updated: Jul 29 2025 with Bootstrap v5.3.7
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body class="booking-page">

  <header id="header" class="header sticky-top">

    <div class="topbar d-flex align-items-center dark-background">
      <div class="container d-flex justify-content-center justify-content-md-between">
        <div class="contact-info d-flex align-items-center">
          <i class="bi bi-envelope d-flex align-items-center"><a href="mailto:Gaurikeerthanagvyr@gmail.com">Gaurikeerthanagvyr@gmail.com</a></i>
          <i class="bi bi-phone d-flex align-items-center ms-4"><span>+91 994779277 , +91 4872081979</span></i>
        </div>
        <div class="social-links d-none d-md-flex align-items-center">
          <a href="https://instagram.com/gaurikeerthanaresidency_" class="instagram"><i class="bi bi-instagram"></i></a>
          <a href="https://wa.me/919947792777" class="Whattsapp"><i class="bi bi-whatsapp"></i></a>
        </div>
      </div>
    </div><!-- End Top Bar -->

    <div class="branding d-flex align-items-cente">

      <div class="container position-relative d-flex align-items-center justify-content-between">
        <a href="index.html" class="logo d-flex align-items-center">
          <!-- Uncomment the line below if you also wish to use an image logo -->
          <!-- <img src="assets/img/logo.webp" alt=""> -->
          <h1 class="sitename">Gaurikeerthana</h1>
        </a>

        <nav id="navmenu" class="navmenu">
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="rooms.html">Rooms</a></li>
            <li><a href="amenities.html">Amenities</a></li>
            <li><a href="location.html">Location</a></li>
            <li class="dropdown"><a href="#"><span>Pages</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
              <ul>
                <li><a href="room-details.html">Room Details</a></li>
                <li><a href="gallery.html">Gallery</a></li>
                <li><a href="booking.html" class="active">Booking</a></li>
                <li><a href="terms.html">Terms Page</a></li>
              </ul>
            </li>
            <li><a href="contact.html">Contact</a></li>

            

    </div>

  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title light-background">
      <div class="container d-lg-flex justify-content-between align-items-center">
        <h1 class="mb-2 mb-lg-0">Booking</h1>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="index.html">Home</a></li>
            <li class="current">Booking</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <!-- Booking Section -->
    <section id="booking" class="booking section">

      <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="reservation-wrapper">

          <div class="reservation-header text-center" data-aos="fade-up" data-aos-delay="200">
            <h2>BOOK Your Stay</h2>
            <p class="lead">Experience unmatched hospitality with our streamlined booking process</p>
          </div>

          <div class="booking-grid">

            <div class="booking-form-section" data-aos="fade-right" data-aos-delay="300">
              <div class="form-container">
                <form class="reservation-form" action="booking-confirmation.html" method="GET">

                  <div class="form-section">
                    <h4>Room Preferences</h4>
                    <div class="form-group">
                      <label for="room-type" class="form-label">Room Type</label>
                      <select class="form-select" id="room-type" name="room_type" required="">
                        <option value="">Choose room type</option>
                        <option value="normal-non-ac">Normal Non-AC Room - ₹2,000/night</option>
                        <option value="normal-ac">Normal AC Room - ₹2,500/night</option>
                        <option value="deluxe-ac">Deluxe AC Room - ₹4,000/night</option>
                      </select>
                    </div>
                    
                    <!-- Availability Status -->
                    <div id="availability-status" class="availability-status" style="display: none;">
                      <div class="availability-content">
                        <div class="availability-icon">
                          <i class="bi bi-info-circle"></i>
                        </div>
                        <div class="availability-text">
                          <h6 id="availability-title">Checking Availability...</h6>
                          <p id="availability-message">Please wait while we check room availability.</p>
                        </div>
                      </div>
                      <div id="availability-actions" class="availability-actions" style="display: none;">
                        <button type="button" class="btn btn-outline-primary btn-sm" id="check-alternatives">Check Alternatives</button>
                      </div>
                    </div>
                  </div>

                  <div class="form-section">
                    <h4>Booking Details</h4>
                    <div class="form-grid">
                      <div class="form-group">
                        <label for="arrival-date" class="form-label">Arrival Date</label>
                        <input type="date" class="form-control" id="arrival-date" name="arrival_date" required="" min="">
                      </div>
                      <div class="form-group">
                        <label for="departure-date" class="form-label">Departure Date</label>
                        <input type="date" class="form-control" id="departure-date" name="departure_date" required="" min="">
                      </div>
                      <div class="form-group">
                        <label for="guest-count" class="form-label">Total Guests</label>
                        <select class="form-select" id="guest-count" name="guest_count" required="">
                          <option value="">Choose guests</option>
                          <option value="1">1 Guest</option>
                          <option value="2">2 Guests</option>
                          <option value="3">3 Guests</option>
                          <option value="4">4 Guests</option>
                          <option value="5">5+ Guests</option>
                        </select>
                      </div>
                      <div class="form-group">
                        <label for="room-count" class="form-label">Total Rooms</label>
                        <select class="form-select" id="room-count" name="room_count" required="">
                          <option value="">Choose rooms</option>
                          <option value="1">1 Room</option>
                          <option value="2">2 Rooms</option>
                          <option value="3">3 Rooms</option>
                          <option value="4">4 Rooms</option>
                          <option value="5">5 Rooms</option>
                          <option value="6">6 Rooms</option>
                        </select>
                        <small class="form-text text-muted" id="room-count-help">Maximum rooms available: <span id="max-rooms-display">Please select room type</span></small>
                      </div>
                    </div>
                  </div>

                  <div class="form-section">
                    <h4>Guest Information</h4>
                    <div class="form-grid">
                      <div class="form-group full-width">
                        <label for="primary-guest" class="form-label">Primary Guest Name</label>
                        <input type="text" class="form-control" id="primary-guest" name="primary_guest" required="">
                      </div>
                      <div class="form-group">
                        <label for="contact-email" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="contact-email" name="contact_email" required="">
                      </div>
                      <div class="form-group">
                        <label for="contact-phone" class="form-label">Contact Number</label>
                        <input type="tel" class="form-control" id="contact-phone" name="contact_phone" required="" pattern="[0-9]{10}" placeholder="Enter 10-digit mobile number">
                        <div class="invalid-feedback">Please enter a valid 10-digit mobile number.</div>
                      </div>
                    </div>
                  </div>

                  <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                      <i class="bi bi-calendar-plus me-2"></i>
                      Submit 
                    </button>
                  </div>

                </form>
              </div>
            </div>

            <div class="hotel-showcase" data-aos="fade-left" data-aos-delay="400">
              <div class="showcase-image">
                <img src="https://res.cloudinary.com/dwr3ssg8e/image/upload/v1758381639/ix4nbwbcpm2nque7wsrx.webp" alt="Hotel luxury showcase" class="img-fluid">
              </div>

              <div class="hotel-highlights">
                <h3>Why Choose Our Hotel</h3>
                <div class="highlights-grid">
                  <div class="highlight-item">
                    <div class="highlight-icon">
                      <i class="bi bi-wifi"></i>
                    </div>
                    <div class="highlight-content">
                      <h5>Premium Connectivity</h5>
                      <p>High-speed internet access in all areas</p>
                    </div>
                  </div>
                  <div class="highlight-item">
                    <div class="highlight-icon">
                      <i class="bi bi-clock"></i>
                    </div>
                    <div class="highlight-content">
                      <h5>24/7 Service</h5>
                      <p>Round-the-clock assistance and support</p>
                    </div>
                  </div>
                  <div class="highlight-item">
                    <div class="highlight-icon">
                      <i class="bi bi-car-front"></i>
                    </div>
                    <div class="highlight-content">
                      <h5>parking space</h5>
                      <p>huge parking space avilable</p>
                    </div>
                  </div>
                  
                </div>
              </div>

              <div class="booking-guarantees">
                <div class="guarantee-item">
                  <i class="bi bi-shield-check"></i>
                  <span>Secure Booking</span>
                </div>
                <div class="guarantee-item">
                  <i class="bi bi-arrow-clockwise"></i>
                  <span>Flexible Cancellation</span>
                </div>
                <div class="guarantee-item">
                  <i class="bi bi-telephone"></i>
                  <span>24/7 Support</span>
                </div>
              </div>
            </div>

          </div>

        </div>

      </div>

    </section><!-- /Booking Section -->

  </main>

  <footer id="footer" class="footer position-relative dark-background">

    <div class="footer-top">
      <div class="container">
        <div class="row gy-4">
          <div class="col-lg-4 col-md-6 footer-about">
            <a href="index.html" class="logo d-flex align-items-center">
              <span class="sitename">GAURIKEERTHANA RESIDENCY</span>
            </a>
            <div class="footer-contact pt-3">
              <p>GAURIKEERTHANA RESIDENCY</p>
              <p>Gaurikeerthana, Kerala, India</p>
              <p class="mt-3"><strong>Phone:</strong> <span>+91 994779277 , +91 4872081979</span></p>
              <p><strong>Email:</strong> <span>Gaurikeerthanagvyr@gmail.com</span></p>
            </div>
          </div>

          <div class="col-lg-2 col-md-3 footer-links">
            <h4>Useful Links</h4>
            <ul>
              <li><a href="#">Home</a></li>
              <li><a href="#">About us</a></li>
              <li><a href="#">Services</a></li>
              <li><a href="#">Terms of service</a></li>
              <li><a href="#">Privacy policy</a></li>
            </ul>
          </div>

        </div>
      </div>
    </div>

    <div class="copyright text-center">
      <div class="container d-flex flex-column flex-lg-row justify-content-center justify-content-lg-between align-items-center">

        <div class="d-flex flex-column align-items-center align-items-lg-start">
          <div>
            © Copyright <strong><span>MyWebsite</span></strong>. All Rights Reserved
          </div>
          <div class="credits">
            <!-- All the links in the footer should remain intact. -->
            <!-- You can delete the links only if you purchased the pro version. -->
            <!-- Licensing information: https://bootstrapmade.com/license/ -->
            <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/herobiz-bootstrap-business-template/ -->
            Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
          </div>
        </div>

        <div class="social-links order-first order-lg-last mb-3 mb-lg-0">
          <a href="https://instagram.com/gaurikeerthanaresidency_"><i class="bi bi-instagram"></i></a>
          <a href="https://wa.me/919947792777"><i class="bi bi-whattsapp"></i></a>
        </div>

      </div>
    </div>

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

  <!-- Booking Form Validation Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {

      // Update departure date minimum when arrival date changes
      document.getElementById('arrival-date').addEventListener('change', function() {
        const arrivalDate = this.value;
        if (arrivalDate) {
          // Set minimum departure date to day after arrival
          const nextDay = new Date(arrivalDate);
          nextDay.setDate(nextDay.getDate() + 1);
          document.getElementById('departure-date').setAttribute('min', nextDay.toISOString().split('T')[0]);
          
          // Check availability if both dates and room type are selected
          checkAndDisplayAvailability();
        }
      });

      // Check availability when departure date changes
      document.getElementById('departure-date').addEventListener('change', function() {
        checkAndDisplayAvailability();
      });

      // Check availability when room type changes
      document.getElementById('room-type').addEventListener('change', function() {
        checkAndDisplayAvailability();
      });

      // Check availability when room count changes
      document.getElementById('room-count').addEventListener('change', function() {
        const selectedRoomType = document.getElementById('room-type').value;
        const selectedRoomCount = parseInt(this.value);
        
        // Check if selected room count exceeds total capacity
        
        if (selectedRoomType && selectedRoomCount > roomCapacity[selectedRoomType]) {
          alert(`Maximum ${roomCapacity[selectedRoomType]} ${getRoomTypeName(selectedRoomType)} rooms available. Please select fewer rooms.`);
          this.value = roomCapacity[selectedRoomType];
        }
        
        checkAndDisplayAvailability();
      });

      // Function to check and display availability
      async function checkAndDisplayAvailability() {
        const roomType = document.getElementById('room-type').value;
        const arrivalDate = document.getElementById('arrival-date').value;
        const departureDate = document.getElementById('departure-date').value;
        const requestedRooms = parseInt(document.getElementById('room-count').value) || 1;

        if (roomType && arrivalDate && departureDate) {
          try {
            const availableRooms = await checkRoomAvailability(roomType, arrivalDate, departureDate, requestedRooms);
            displayAvailabilityStatus(availableRooms, roomType, requestedRooms);
          } catch (error) {
            console.error('Error checking availability:', error);
          }
        }
      }

      // Display availability status to user
      function displayAvailabilityStatus(availableRooms, roomType, requestedRooms = 1) {
        // Remove any existing availability messages
        const existingMessage = document.getElementById('availability-message');
        if (existingMessage) {
          existingMessage.remove();
        }

        const roomTypeName = getRoomTypeName(roomType);
        
        if (availableRooms === 0) {
          // No rooms available or not enough rooms
          const message = document.createElement('div');
          message.id = 'availability-message';
          message.className = 'alert alert-danger mt-3';
          
          if (requestedRooms > 1) {
            message.innerHTML = `
              <i class="bi bi-exclamation-triangle me-2"></i>
              <strong>Not enough rooms:</strong> You requested ${requestedRooms} ${roomTypeName} rooms, but there are not enough available for the selected dates. 
              Please reduce the number of rooms or choose different dates.
            `;
          } else {
            message.innerHTML = `
              <i class="bi bi-exclamation-triangle me-2"></i>
              <strong>No ${roomTypeName} rooms available</strong> for the selected dates. 
              Please choose different dates or a different room type.
            `;
          }
          
          // Insert after room type select
          document.getElementById('room-type').parentNode.parentNode.appendChild(message);
        } else if (availableRooms < requestedRooms) {
          // Requested more rooms than available
          const message = document.createElement('div');
          message.id = 'availability-message';
          message.className = 'alert alert-danger mt-3';
          message.innerHTML = `
            <i class="bi bi-exclamation-triangle me-2"></i>
            <strong>Not enough rooms:</strong> You requested ${requestedRooms} ${roomTypeName} rooms, but only ${availableRooms} room${availableRooms > 1 ? 's' : ''} available for the selected dates.
          `;
          
          // Insert after room type select
          document.getElementById('room-type').parentNode.parentNode.appendChild(message);
        } else if (availableRooms === requestedRooms) {
          // Exact match
          const message = document.createElement('div');
          message.id = 'availability-message';
          message.className = 'alert alert-warning mt-3';
          message.innerHTML = `
            <i class="bi bi-info-circle me-2"></i>
            <strong>Limited availability:</strong> Exactly ${availableRooms} ${roomTypeName} room${availableRooms > 1 ? 's' : ''} available for your requested ${requestedRooms} room${requestedRooms > 1 ? 's' : ''}.
          `;
          
          // Insert after room type select
          document.getElementById('room-type').parentNode.parentNode.appendChild(message);
        } else {
          // Good availability
          const message = document.createElement('div');
          message.id = 'availability-message';
          message.className = 'alert alert-success mt-3';
          message.innerHTML = `
            <i class="bi bi-check-circle me-2"></i>
            <strong>Good availability:</strong> ${availableRooms} ${roomTypeName} rooms available for your requested ${requestedRooms} room${requestedRooms > 1 ? 's' : ''}.
          `;
          
          // Insert after room type select
          document.getElementById('room-type').parentNode.parentNode.appendChild(message);
        }
      }

      // Room availability data
      const roomAvailability = {
        'normal-non-ac': 3,
        'normal-ac': 6,
        'deluxe-ac': 2
      };

      // Form validation
      const form = document.querySelector('.reservation-form');
      const submitButton = form.querySelector('button[type="submit"]');

      // Add form validation
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Check if all required fields are filled
        const requiredFields = form.querySelectorAll('[required]');
        let allFieldsFilled = true;
        let emptyFields = [];

        requiredFields.forEach(field => {
          if (!field.value.trim()) {
            allFieldsFilled = false;
            emptyFields.push(field.previousElementSibling.textContent || field.getAttribute('name'));
            field.classList.add('is-invalid');
          } else {
            field.classList.remove('is-invalid');
          }
        });

        // Check if departure date is after arrival date
        const arrivalDate = new Date(document.getElementById('arrival-date').value);
        const departureDate = new Date(document.getElementById('departure-date').value);
        
        if (departureDate <= arrivalDate) {
          allFieldsFilled = false;
          document.getElementById('departure-date').classList.add('is-invalid');
          alert('Departure date must be after arrival date.');
        }

        // Check phone number validation
        const phoneInput = document.getElementById('contact-phone');
        const phonePattern = /^[0-9]{10}$/;
        if (!phonePattern.test(phoneInput.value)) {
          allFieldsFilled = false;
          phoneInput.classList.add('is-invalid');
          alert('Please enter a valid 10-digit mobile number.');
        }


        // Check room availability
        const selectedRoomType = document.getElementById('room-type').value;
        const requestedRooms = parseInt(document.getElementById('room-count').value);
        const departureDateValue = document.getElementById('departure-date').value;
        
        if (selectedRoomType && requestedRooms && arrivalDateValue && departureDateValue) {
          const availableRooms = await checkRoomAvailability(selectedRoomType, arrivalDateValue, departureDateValue, requestedRooms);
          
          if (availableRooms === 0) {
            allFieldsFilled = false;
            document.getElementById('room-count').classList.add('is-invalid');
            
            // Calculate actual available rooms for the message
            const actualAvailable = await checkRoomAvailability(selectedRoomType, arrivalDate, departureDate, 1);
            alert(`Not enough ${getRoomTypeName(selectedRoomType)} rooms available for the selected dates. Only ${actualAvailable} room${actualAvailable > 1 ? 's' : ''} available. Please reduce the number of rooms or choose different dates.`);
          }
        }

        if (!allFieldsFilled) {
          alert('Please fill in all required fields and check room availability before submitting.');
          return false;
        }

        // If all validations pass, submit the form
        this.submit();
      });

      // Function to get room type name
      function getRoomTypeName(roomType) {
        const names = {
          'normal-non-ac': 'Normal Non-AC',
          'normal-ac': 'Normal AC',
          'deluxe-ac': 'Deluxe AC'
        };
        return names[roomType] || roomType;
      }

      // Remove invalid class when user starts typing
      const inputs = form.querySelectorAll('input, select, textarea');
      inputs.forEach(input => {
        input.addEventListener('input', function() {
          this.classList.remove('is-invalid');
        });
      });
    });



    // Enhanced daily room availability checking function
    async function checkRoomAvailability(roomType, arrivalDate, departureDate, requestedRooms = 1) {
      try {
        // Get room capacity limits

        // Try to get bookings from Firebase first
        let bookings = [];
        if (window.firebaseBookingService) {
          bookings = await window.firebaseBookingService.getAllBookings();
        } else {
          // Fallback to localStorage
          bookings = loadBookingsFromLocalStorage();
        }

        // Get all dates between arrival and departure (excluding departure date)
        const requestedDates = getDateRange(arrivalDate, departureDate);
        
        // Check availability for each day
        let minAvailableRooms = roomCapacity[roomType];
        
        for (const date of requestedDates) {
          const availableOnDate = await checkAvailabilityForSpecificDate(roomType, date, bookings, roomCapacity[roomType]);
          minAvailableRooms = Math.min(minAvailableRooms, availableOnDate);
          
          // If any date has fewer rooms than requested, return 0
          if (availableOnDate < requestedRooms) {
            console.log(`Not enough rooms available on ${date}. Available: ${availableOnDate}, Requested: ${requestedRooms}`);
            return 0;
          }
        }

        // Ensure we don't exceed total capacity
        if (minAvailableRooms < requestedRooms) {
          console.log(`Not enough rooms available for entire stay. Available: ${minAvailableRooms}, Requested: ${requestedRooms}`);
          return 0;
        }

        return minAvailableRooms;

      } catch (error) {
        console.error('Error checking room availability:', error);
        // Return 0 if error occurs to prevent overbooking
        return 0;
      }
    }

    // Check availability for a specific date
    async function checkAvailabilityForSpecificDate(roomType, date, bookings, totalCapacity) {
      // Filter confirmed bookings for the same room type that include this date
      const conflictingBookings = bookings.filter(booking => {
        return booking.status === 'confirmed' &&
               booking.roomType === roomType &&
               isDateInRange(date, booking.arrivalDate, booking.departureDate);
      });

      // Calculate total booked rooms for this specific date
      const totalBookedRooms = conflictingBookings.reduce((sum, booking) => {
        return sum + parseInt(booking.roomCount);
      }, 0);

      // Return available rooms for this date
      return Math.max(0, totalCapacity - totalBookedRooms);
    }

    // Get array of dates between start and end date (excluding end date)
    function getDateRange(startDate, endDate) {
      const dates = [];
      const start = new Date(startDate);
      const end = new Date(endDate);
      
      // Exclude the departure date (checkout day)
      end.setDate(end.getDate() - 1);
      
      for (let date = new Date(start); date <= end; date.setDate(date.getDate() + 1)) {
        dates.push(date.toISOString().split('T')[0]);
      }
      
      return dates;
    }

    // Check if a specific date falls within a date range
    function isDateInRange(checkDate, startDate, endDate) {
      const check = new Date(checkDate);
      const start = new Date(startDate);
      const end = new Date(endDate);
      
      // Exclude the checkout date (departure date)
      end.setDate(end.getDate() - 1);
      
      return check >= start && check <= end;
    }

    function isDateRangeOverlapping(start1, end1, start2, end2) {
      const start1Date = new Date(start1);
      const end1Date = new Date(end1);
      const start2Date = new Date(start2);
      const end2Date = new Date(end2);

      return start1Date < end2Date && start2Date < end1Date;
    }

    function loadBookingsFromLocalStorage() {
      const bookings = [];
      
      // Only check for confirmed bookings (successful transactions)
      const confirmedBooking = localStorage.getItem('confirmedBooking');
      if (confirmedBooking) {
        const parsed = JSON.parse(confirmedBooking);
        if (parsed && parsed.status === 'confirmed') {
          bookings.push(parsed);
        }
      }
      
      // Note: Failed bookings are not considered for availability
      // as they don't represent confirmed room occupancy
      
      return bookings;
    }

    // Admin access with Ctrl+A shortcut
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'a') {
        e.preventDefault();
        window.location.href = 'admin-login.html';
      }
    });

    let availabilityCheckTimeout;
    let isCheckingAvailability = false;

    // Room capacity limits
    const roomCapacity = {
      'normal-non-ac': 3,
      'normal-ac': 6,
      'deluxe-ac': 2
    };
    
    const roomTypeNames = {
      'normal-non-ac': 'Normal Non-AC Room',
      'normal-ac': 'Normal AC Room',
      'deluxe-ac': 'Deluxe AC Room'
    };

    async function updateRoomCountOptions() {
      const roomTypeSelect = document.getElementById('room-type');
      const roomCountSelect = document.getElementById('room-count');
      const maxRoomsDisplay = document.getElementById('max-rooms-display');
      const arrivalDate = document.getElementById('arrival-date').value;
      const departureDate = document.getElementById('departure-date').value;
      
      const selectedRoomType = roomTypeSelect.value;
      
      if (!selectedRoomType) {
        // No room type selected
        maxRoomsDisplay.textContent = 'Please select room type';
        roomCountSelect.innerHTML = '<option value="">Choose rooms</option>';
        roomCountSelect.disabled = true;
        return;
      }
      
      const maxCapacity = roomCapacity[selectedRoomType];
      
      if (!maxCapacity) {
        console.error('Unknown room type:', selectedRoomType);
        maxRoomsDisplay.textContent = 'Error';
        roomCountSelect.innerHTML = '<option value="">Choose rooms</option>';
        roomCountSelect.disabled = true;
        return;
      }
      
      // Show loading state when checking database
      if (arrivalDate && departureDate && new Date(departureDate) > new Date(arrivalDate)) {
        maxRoomsDisplay.textContent = 'Checking availability...';
        roomCountSelect.disabled = true;
        roomCountSelect.innerHTML = '<option value="">Checking...</option>';
      }
      
      // If dates are selected, check actual availability
      let availableRooms = maxCapacity;
      if (arrivalDate && departureDate && new Date(departureDate) > new Date(arrivalDate)) {
        try {
          let bookings = [];
          if (window.firebaseBookingService) {
            bookings = await window.firebaseBookingService.getAllBookings();
          } else {
            bookings = loadBookingsFromLocalStorage();
          }
          
          const requestedDates = getDateRange(arrivalDate, departureDate);
          availableRooms = maxCapacity;
          
          for (const date of requestedDates) {
            const availableOnDate = await checkAvailabilityForSpecificDate(selectedRoomType, date, bookings, maxCapacity);
            availableRooms = Math.min(availableRooms, availableOnDate);
          }
        } catch (error) {
          console.error('Error checking availability for room count options:', error);
          // Fall back to showing all rooms up to capacity
          availableRooms = maxCapacity;
        }
      }
      
      // Update the display with clear messaging
      if (arrivalDate && departureDate) {
        if (availableRooms === 0) {
          maxRoomsDisplay.textContent = 'No rooms available';
        } else if (availableRooms < maxCapacity) {
          maxRoomsDisplay.textContent = `${availableRooms} of ${maxCapacity} rooms available`;
        } else {
          maxRoomsDisplay.textContent = `All ${availableRooms} rooms available`;
        }
      } else {
        maxRoomsDisplay.textContent = `${maxCapacity} rooms total in property`;
      }
      
      roomCountSelect.disabled = false;
      
      // Clear existing options
      roomCountSelect.innerHTML = '<option value="">Choose rooms</option>';
      
      // Add options up to the available rooms (or max capacity if no dates selected)
      const roomsToShow = arrivalDate && departureDate ? availableRooms : maxCapacity;
      
      if (roomsToShow === 0) {
        roomCountSelect.innerHTML = '<option value="">No rooms available</option>';
        roomCountSelect.disabled = true;
      } else {
        for (let i = 1; i <= roomsToShow; i++) {
          const option = document.createElement('option');
          option.value = i;
          option.textContent = `${i} Room${i > 1 ? 's' : ''}`;
          roomCountSelect.appendChild(option);
        }
      }
      
      // Reset the selection
      roomCountSelect.value = '';
    }

    // Add event listeners for real-time availability checking
    document.addEventListener('DOMContentLoaded', function() {
      const arrivalDateInput = document.getElementById('arrival-date');
      const departureDateInput = document.getElementById('departure-date');
      const roomTypeSelect = document.getElementById('room-type');
      const roomCountSelect = document.getElementById('room-count');

      // Initialize room count options based on current room type selection
      updateRoomCountOptions();

      // Add event listeners
      arrivalDateInput.addEventListener('change', async function() {
        await updateRoomCountOptions();
        checkAvailability();
      });
      departureDateInput.addEventListener('change', async function() {
        await updateRoomCountOptions();
        checkAvailability();
      });
      roomTypeSelect.addEventListener('change', async function() {
        await updateRoomCountOptions();
        checkAvailability();
      });
      roomCountSelect.addEventListener('change', checkAvailability);

      // Check alternatives button
      document.getElementById('check-alternatives').addEventListener('click', showAlternatives);
    });

    async function checkAvailability() {
      // Clear previous timeout
      if (availabilityCheckTimeout) {
        clearTimeout(availabilityCheckTimeout);
      }

      // Debounce the check to avoid too many API calls
      availabilityCheckTimeout = setTimeout(async () => {
        const arrivalDate = document.getElementById('arrival-date').value;
        const departureDate = document.getElementById('departure-date').value;
        const roomType = document.getElementById('room-type').value;
        const roomCount = parseInt(document.getElementById('room-count').value) || 1;

        // Only check if all required fields are filled
        if (!arrivalDate || !departureDate || !roomType) {
          hideAvailabilityStatus();
          return;
        }

        // Validate dates
        if (new Date(departureDate) <= new Date(arrivalDate)) {
          showAvailabilityStatus('error', 'Invalid Dates', 'Check-out date must be after check-in date.');
          return;
        }

        await performAvailabilityCheck(roomType, arrivalDate, departureDate, roomCount);
      }, 500); // 500ms delay
    }

    async function performAvailabilityCheck(roomType, arrivalDate, departureDate, requestedRooms) {
      if (isCheckingAvailability) return;
      
      isCheckingAvailability = true;
      showAvailabilityStatus('checking', 'Checking Availability...', 'Please wait while we verify room availability.');

      try {
        // Get bookings from database
        let bookings = [];
        if (window.firebaseBookingService) {
          bookings = await window.firebaseBookingService.getAllBookings();
        } else {
          bookings = loadBookingsFromLocalStorage();
        }

        // Use the existing robust availability checking function
        const availableRooms = await checkRoomAvailability(roomType, arrivalDate, departureDate, requestedRooms);

        // Update room count options based on actual availability
        await updateRoomCountOptions();

        // Check if rooms are available
        if (availableRooms >= requestedRooms) {
          showAvailabilityStatus('available', 'Rooms Available!', 
            `${requestedRooms} room(s) of ${getRoomTypeName(roomType)} available for your selected dates.`);
          enableFormSubmission();
        } else if (availableRooms > 0) {
          showAvailabilityStatus('unavailable', 'Limited Availability', 
            `Only ${availableRooms} room(s) available. You requested ${requestedRooms} rooms. Please reduce your room count or select alternative dates.`);
          disableFormSubmission();
          showAlternativesButton();
        } else {
          showAvailabilityStatus('unavailable', 'No Rooms Available', 
            `No ${getRoomTypeName(roomType)} rooms available for your selected dates. All ${roomCapacity[roomType]} rooms are already booked.`);
          disableFormSubmission();
          showAlternativesButton();
        }

      } catch (error) {
        console.error('Error checking availability:', error);
        showAvailabilityStatus('error', 'Check Failed', 'Unable to check availability. Please try again.');
        disableFormSubmission();
      } finally {
        isCheckingAvailability = false;
      }
    }

    function showAvailabilityStatus(type, title, message) {
      const statusDiv = document.getElementById('availability-status');
      const titleElement = document.getElementById('availability-title');
      const messageElement = document.getElementById('availability-message');
      const iconElement = statusDiv.querySelector('.availability-icon i');

      // Remove existing classes
      statusDiv.className = 'availability-status';
      
      // Add new classes and content
      statusDiv.classList.add(type);
      titleElement.textContent = title;
      messageElement.textContent = message;
      
      // Update icon based on type
      switch(type) {
        case 'checking':
          iconElement.className = 'bi bi-hourglass-split';
          break;
        case 'available':
          iconElement.className = 'bi bi-check-circle';
          break;
        case 'unavailable':
          iconElement.className = 'bi bi-x-circle';
          break;
        case 'error':
          iconElement.className = 'bi bi-exclamation-triangle';
          break;
      }
      
      statusDiv.style.display = 'block';
    }

    function hideAvailabilityStatus() {
      document.getElementById('availability-status').style.display = 'none';
    }

    function showAlternativesButton() {
      document.getElementById('availability-actions').style.display = 'block';
    }

    function hideAlternativesButton() {
      document.getElementById('availability-actions').style.display = 'none';
    }

    function enableFormSubmission() {
      const submitButton = document.querySelector('button[type="submit"]');
      if (submitButton) {
        submitButton.disabled = false;
        submitButton.textContent = 'Proceed to Booking';
      }
      hideAlternativesButton();
    }

    function disableFormSubmission() {
      const submitButton = document.querySelector('button[type="submit"]');
      if (submitButton) {
        submitButton.disabled = true;
        submitButton.textContent = 'Check Availability First';
      }
    }

    async function showAlternatives() {
      const roomType = document.getElementById('room-type').value;
      const arrivalDate = document.getElementById('arrival-date').value;
      const departureDate = document.getElementById('departure-date').value;
      const roomCount = parseInt(document.getElementById('room-count').value) || 1;

      try {
        // Get bookings from database
        let bookings = [];
        if (window.firebaseBookingService) {
          bookings = await window.firebaseBookingService.getAllBookings();
        } else {
          bookings = loadBookingsFromLocalStorage();
        }

        const alternatives = await findAlternativeOptions(roomType, arrivalDate, departureDate, roomCount, bookings);
        
        if (alternatives.length > 0) {
          showAlternativesList(alternatives);
        } else {
          showAvailabilityStatus('unavailable', 'No Alternatives Found', 
            'Unfortunately, no rooms are available for your selected dates. Please try different dates.');
        }
      } catch (error) {
        console.error('Error finding alternatives:', error);
        showAvailabilityStatus('error', 'Error', 'Unable to find alternatives. Please try again.');
      }
    }

    async function findAlternativeOptions(selectedRoomType, arrivalDate, departureDate, requestedRooms, bookings) {
      const alternatives = [];

      // Check other room types
      for (const [roomType, capacity] of Object.entries(roomCapacity)) {
        if (roomType === selectedRoomType) continue;

        // Use the robust availability checking function
        const availableRooms = await checkRoomAvailability(roomType, arrivalDate, departureDate, requestedRooms);

        if (availableRooms >= requestedRooms) {
          alternatives.push({
            type: 'room_type',
            roomType: roomType,
            roomTypeName: getRoomTypeName(roomType),
            availableRooms: availableRooms
          });
        }
      }

      // Check nearby dates (within 3 days)
      for (let dayOffset = -3; dayOffset <= 3; dayOffset++) {
        if (dayOffset === 0) continue;

        const newArrivalDate = new Date(arrivalDate);
        newArrivalDate.setDate(newArrivalDate.getDate() + dayOffset);
        const newArrivalDateStr = newArrivalDate.toISOString().split('T')[0];

        const newDepartureDate = new Date(departureDate);
        newDepartureDate.setDate(newDepartureDate.getDate() + dayOffset);
        const newDepartureDateStr = newDepartureDate.toISOString().split('T')[0];

        // Skip if dates are in the past
        if (newArrivalDate < new Date()) continue;

        // Use the robust availability checking function
        const availableRooms = await checkRoomAvailability(selectedRoomType, newArrivalDateStr, newDepartureDateStr, requestedRooms);

        if (availableRooms >= requestedRooms) {
          alternatives.push({
            type: 'date',
            arrivalDate: newArrivalDateStr,
            departureDate: newDepartureDateStr,
            roomType: selectedRoomType,
            roomTypeName: getRoomTypeName(selectedRoomType),
            dayOffset: dayOffset,
            availableRooms: availableRooms
          });
        }
      }

      return alternatives.slice(0, 5); // Limit to 5 alternatives
    }

    function showAlternativesList(alternatives) {
      const alternativesHtml = alternatives.map(alt => {
        if (alt.type === 'room_type') {
          return `<li>Switch to <strong>${alt.roomTypeName}</strong> (${alt.availableRooms} rooms available)</li>`;
        } else if (alt.type === 'date') {
          const dateStr = new Date(alt.arrivalDate).toLocaleDateString();
          const offsetText = alt.dayOffset > 0 ? `${alt.dayOffset} days later` : `${Math.abs(alt.dayOffset)} days earlier`;
          return `<li>Try <strong>${dateStr}</strong> (${offsetText}) - ${alt.availableRooms} rooms available</li>`;
        }
        return '';
      }).join('');

      const alternativesDiv = document.createElement('div');
      alternativesDiv.className = 'alternative-options';
      alternativesDiv.innerHTML = `
        <h6>Available Alternatives:</h6>
        <ul class="alternative-list">
          ${alternativesHtml}
        </ul>
      `;

      const statusDiv = document.getElementById('availability-status');
      // Remove existing alternatives
      const existingAlternatives = statusDiv.querySelector('.alternative-options');
      if (existingAlternatives) {
        existingAlternatives.remove();
      }
      
      statusDiv.appendChild(alternativesDiv);
    }

    function getRoomTypeName(roomType) {
      return roomTypeNames[roomType] || roomType;
    }

    // Helper function to get date range
    function getDateRange(startDate, endDate) {
      const dates = [];
      const currentDate = new Date(startDate);
      const end = new Date(endDate);
      
      while (currentDate < end) {
        dates.push(currentDate.toISOString().split('T')[0]);
        currentDate.setDate(currentDate.getDate() + 1);
      }
      
      return dates;
    }

    // Override form submission to check availability first
    document.querySelector('.reservation-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const statusDiv = document.getElementById('availability-status');
      const isAvailable = statusDiv.classList.contains('available');
      
      if (!isAvailable) {
        showAvailabilityStatus('error', 'Check Availability First', 'Please wait for availability confirmation before proceeding.');
        return;
      }

      // Double-check availability before submission to prevent race conditions
      const arrivalDate = document.getElementById('arrival-date').value;
      const departureDate = document.getElementById('departure-date').value;
      const roomType = document.getElementById('room-type').value;
      const roomCount = parseInt(document.getElementById('room-count').value) || 1;

      // Validate room count against room type capacity
      const maxCapacity = roomCapacity[roomType];
      if (roomCount > maxCapacity) {
        showAvailabilityStatus('error', 'Invalid Selection', 
          `You selected ${roomCount} rooms, but ${getRoomTypeName(roomType)} only has ${maxCapacity} rooms available. Please select a valid number of rooms.`);
        disableFormSubmission();
        return;
      }

      showAvailabilityStatus('checking', 'Final Verification...', 'Performing final availability check before booking...');

      try {
        // Get fresh data from database
        let bookings = [];
        if (window.firebaseBookingService) {
          bookings = await window.firebaseBookingService.getAllBookings();
        } else {
          bookings = loadBookingsFromLocalStorage();
        }

        // Final availability check
        const availableRooms = await checkRoomAvailability(roomType, arrivalDate, departureDate, roomCount);
        
        if (availableRooms >= roomCount) {
          showAvailabilityStatus('available', 'Booking Confirmed!', 'Availability confirmed. Proceeding to booking...');
          
          // Small delay to show confirmation message
          setTimeout(() => {
            this.submit();
          }, 1000);
        } else {
          showAvailabilityStatus('unavailable', 'Booking No Longer Available', 
            `Sorry, the ${roomCount} room(s) are no longer available. Only ${availableRooms} room(s) remaining. Please select fewer rooms or different dates.`);
          disableFormSubmission();
        }
      } catch (error) {
        console.error('Error in final availability check:', error);
        showAvailabilityStatus('error', 'Verification Failed', 'Unable to verify availability. Please try again.');
        disableFormSubmission();
      }
    });
  </script>

</body>

</html>